# Lefthook configuration for Git hooks
# Install: lefthook install
# Run manually: lefthook run pre-commit
# Skip hooks with: LEFTHOOK=0 git commit -m "message"
# Skip specific command: LEFTHOOK_EXCLUDE=test git commit -m "message"

glob_matcher: doublestar

pre-commit:
  parallel: true
  jobs:
    - name: fmt
      glob: "**/{*.go,go.mod,go.sum}"
      run: make fmt
      stage_fixed: true
    - name: lint
      glob: "**/{*.go,go.mod,go.sum}"
      run: make lint
    - name: vet
      glob: "**/{*.go,go.mod,go.sum}"
      run: make vet

pre-push:
  parallel: true
  jobs:
    - name: sec
      glob: "**/{*.go,go.mod,go.sum}"
      run: command -v gosec >/dev/null && gosec -quiet ./... || echo "[gosec] skipped"
    - name: test
      glob: "**/{*.go,go.mod,go.sum,*.yaml,*.yml}"
      run: make test
